---
date: 2025-07-07 16:47:22
updated: 2025-07-17 07:07:00
---
## # ä½œä¸šå¸®å‰ç«¯é¢è¯•é¢˜æ¸…å•ï¼ˆæ•´ç†ç‰ˆï¼‰

## ğŸ§  ä¸€ã€JavaScript åŸºç¡€ï¼ˆ14é¢˜ï¼‰

#### âœ…ï¸`0.1 + 0.2 == 0.3` ä¸ºä»€ä¹ˆä¸º falseï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ
```
ieee754 åŒç²¾åº¦æµ®ç‚¹æ•°ç²¾åº¦ç¼ºé™·ï¼Œ
1.è½¬æ•´æ•°è¿ç®—
2.ä½¿ç”¨Decimalåº“ï¼ˆé‡‘èè®¡ç®—ï¼‰
```
#### âœ…ï¸`null >= 0` ä¸ºä½•ä¸º trueï¼Ÿ`true == 2` çš„åˆ¤æ–­æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ
```
null -> 0
ç±»å‹è½¬æ¢ï¼šå¯¹è±¡ < åŸºç¡€å€¼ < æ•°å­—
true -> 1
ä¸ºfalse
```
#### âœ…ï¸`typeof null === "object"` çš„åŸå› ï¼Ÿ
```
æ—©æœŸbugã€‚æ—©æœŸjavascripté‡‡ç”¨32ä½å­˜å‚¨ï¼Œä½3ä½è¡¨ç¤ºç±»å‹æ ‡ç­¾ï¼Œnullåº•å±‚ä¸ºå…¨0ï¼Œè¢«è¯¯åˆ¤ä½object
```
#### âœ…ï¸var` å’Œ `let/const` çš„åŒºåˆ«ï¼Ÿå¦‚ä½•ä½“ç°å˜é‡æå‡ï¼Ÿä»€ä¹ˆæ˜¯â€œæš‚æ—¶æ€§æ­»åŒºâ€ï¼Ÿ
```javascript
/*letæ˜¯å—çº§ä½œç”¨åŸŸ
varä¼šè¢«æå‡

å‡½æ•°æå‡ä¼˜å…ˆå˜é‡æå‡: */

console.log(typeof a); // function
function a() {}
var a = 1;
//ä¼šè¢«è§£é‡Šä¸ºï¼š
function a() {}   // ä¼˜å…ˆæå‡ï¼Œå®Œæ•´æå‡å‡½æ•°ä½“
var a;            // åå£°æ˜ï¼Œä½†ä¸ä¼šè¦†ç›–å·²æœ‰çš„å‡½æ•°å£°æ˜
console.log(typeof a); // âœ… functionï¼ˆå‡½æ•°è¿˜æ²¡è¢« 1 è¦†ç›–ï¼‰
a = 1;                 // è¿è¡Œæ—¶èµ‹å€¼ï¼Œæ‰ä¼šå˜æˆæ•°å­—

//ç‰¹æ®Šæƒ…å†µ:
console.log(a) // undefined
var a = function(){}
//è¿™æ˜¯ç”±äºå¼•æ“å°†å®ƒè§£é‡Šä¸ºï¼š
var a
console.log(a)
a = function(){}
```
|å£°æ˜|åœ¨å£°æ˜ä¹‹å‰è®¿é—®|
|---|---|
|`var foo`|`undefined`|
|`let foo`|`ReferenceError`|
|`const foo`|`ReferenceError`|
|`class Foo`|`ReferenceError`|
|`var foo = function() { ... }`|`undefined`|
|`function foo() { ... }`|æ­£å¸¸|
|`import`|æ­£å¸¸|
#### âœ…ï¸JS ä¸­çš„ä½œç”¨åŸŸé“¾æ˜¯å¦‚ä½•å½¢æˆçš„ï¼Ÿ
```
ä½œç”¨åŸŸé“¾æŒ‰ç…§å—å‘ä¸ŠæŸ¥æ‰¾
```
#### âœ…ï¸é—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿä½¿ç”¨åœºæ™¯ï¼Ÿ
```
æ ¸å¿ƒæœ¬è´¨æ˜¯ï¼šå‡½æ•°+å…¶è‡ªå¸¦çš„è¯æ³•ç¯å¢ƒ
åº”ç”¨åœºæ™¯ï¼š
1. å°è£…ç§æœ‰å˜é‡å¦‚æ¨¡å—æ¨¡å¼
2. å‡½æ•°å·¥å‚å¦‚react hooks(useStateæ•è·æ“ä½œå€¼)
3. é˜²æŠ–èŠ‚æµå‡½æ•°
```
#### âœ…ï¸äº‹ä»¶å¾ªç¯æ˜¯ä»€ä¹ˆï¼Ÿå®ä»»åŠ¡ä¸å¾®ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼Ÿ
```
JSå¤„ç†å¼‚æ­¥ä»»åŠ¡çš„æ‰‹æ®µ
å¾®ä»»åŠ¡ä¼˜å…ˆ
è°ƒç”¨æ ˆ -æ ˆç©º> å¾®ä»»åŠ¡ -å¾®ä»»åŠ¡é˜Ÿåˆ—ç©º> raf -> æ¸²æŸ“UIï¼ˆå¦‚æœæœ‰ï¼‰ -> å®ä»»åŠ¡
å¾®ä»»åŠ¡æ˜¯å•é˜Ÿåˆ—ï¼Œä¸¥æ ¼å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ï¼Œæ¸…ç©ºåè¿›å…¥æ¸²æŸ“æµç¨‹
ç°ä»£æµè§ˆå™¨ä¸­ï¼Œå®ä»»åŠ¡æ‰§è¡Œè¾¾åˆ°æ—¶é—´é˜ˆå€¼ä¼šè¢«æ¸²æŸ“è¿›ç¨‹ä¸­æ–­ä¸­æ–­ï¼Œä¸€èˆ¬ä¸º5msï¼ˆä¿è¯é¡µé¢å“åº”èƒ½åŠ›ï¼‰
domæ“ä½œæ˜¯åŒæ­¥çš„
```

| ä»»åŠ¡ç±»å‹                        | è§¦å‘æ–¹å¼/API                    | ä¼˜å…ˆçº§   | å¤‡æ³¨             |
| --------------------------- | --------------------------- | ----- | -------------- |
| ç”¨æˆ·äº¤äº’äº‹ä»¶                      | `click`/`input`/`keydown` ç­‰ | â˜…â˜…â˜…â˜…â˜… | ç«‹å³æ‰§è¡Œï¼Œæœ€é«˜ä¼˜å…ˆçº§     |
| **`postMessage`**           | `window.postMessage()`      | â˜…â˜…â˜…â˜…â˜† | è·¨æ–‡æ¡£é€šä¿¡          |
| **`MutationObserver`**      | DOM å˜æ›´è§‚æµ‹                    | â˜…â˜…â˜…â˜…  | åœ¨å¾®ä»»åŠ¡å‰æ‰§è¡Œï¼ˆç‰¹æ®Šå®ä»»åŠ¡ï¼‰ |
| **`requestAnimationFrame`** | åŠ¨ç”»å¸§å›è°ƒ                       | â˜…â˜…â˜…â˜†  | æ¸²æŸ“å‰æ‰§è¡Œï¼Œå¸§å¯¹é½      |
| ç½‘ç»œ/IO å›è°ƒ                    | `fetch`/`XHR`/`FileReader`  | â˜…â˜…â˜…   | ç½‘ç»œçº¿ç¨‹åˆ°ä¸»çº¿ç¨‹æœ‰å»¶è¿Ÿ    |
| **`setImmediate`**          | Node.js ç‰¹æœ‰                  | â˜…â˜…â˜†   | æµè§ˆå™¨å·²åºŸå¼ƒ         |
| å®šæ—¶å™¨                         | `setTimeout`/`setInterval`  | â˜…â˜…    | åµŒå¥—è°ƒç”¨æ—¶æœ€å°å»¶è¿Ÿ 4ms  |
| **`requestIdleCallback`**   | ç©ºé—²æœŸä»»åŠ¡                       | â˜…     | å¯èƒ½æ°¸ä¸æ‰§è¡Œ         |
| scriptæ ‡ç­¾çš„æ‰§è¡Œ                 | æµè§ˆå™¨è§£æåˆ°script                |       | defer          |

| ä»»åŠ¡ç±»å‹                      | è§¦å‘æ–¹å¼/API                          | æ‰§è¡Œæ—¶æœº           |
| ------------------------- | --------------------------------- | -------------- |
| **`Promise` å›è°ƒ**          | `.then()`/`.catch()`/`.finally()` | å½“å‰å®ä»»åŠ¡ç»“æŸåç«‹å³æ‰§è¡Œ   |
| **`queueMicrotask`**      | `queueMicrotask(callback)`        | åŒ Promise      |
| **`MutationObserver` å›è°ƒ** | DOM å˜æ›´è§‚æµ‹                          | å¾®ä»»åŠ¡é˜¶æ®µ          |
| **`process.nextTick`**    | Node.js ç‰¹æœ‰                        | Node.js ä¸­ä¼˜å…ˆçº§æœ€é«˜ |
|                           |                                   |                |
#### âœ…ï¸`async/await` çš„åº•å±‚åŸç†ï¼Ÿæœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ
```javascript
// æœ¬è´¨æ˜¯è¯­æ³•ç³–ï¼Œå€Ÿé‰´generator
// Babel polyfill
function fetchData() {
  return new Promise((resolve, reject) => {
    // ç”¨ Generator æ¨¡æ‹Ÿ async/await
    const gen = (function* () {
      try {
        const res = yield fetch('https://api.example.com');
        const data = yield res.json();
        resolve(data);
      } catch (err) {
        reject(err);
      }
    })();

    // è‡ªåŠ¨æ‰§è¡Œ Generator
    function step(nextFn) {
      try {
        const { value, done } = nextFn();
        if (done) return;
        Promise.resolve(value).then(
          (val) => step(() => gen.next(val)),
          (err) => step(() => gen.throw(err))
        );
      } catch (err) {
        reject(err);
      }
    }

    step(() => gen.next()); // å¯åŠ¨
  });
}
```

---
## äºŒã€css
### è‡ªé€‚åº”
```javascript
//æ·˜å®flexibleæºç 
(function () {
    var dpr = window.devicePixelRatio;
    var meta = document.createElement('meta');
    var scale = 1 / dpr;
    meta.setAttribute('name', 'viewport');
    meta.setAttribute('content', 'width=device-width, user-scalable=no, initial-scale=' + scale +
      ', maximum-scale=' + scale + ', minimum-scale=' + scale);
    document.getElementsByTagName('head')[0].appendChild(meta);
    // åŠ¨æ€è®¾ç½®çš„ç¼©æ”¾å¤§å°ä¼šå½±å“å¸ƒå±€è§†å£çš„å°ºå¯¸
      function resize() {
      var deviceWidth  = document.documentElement.clientWidth;
      document.documentElement.style.fontSize = (deviceWidth / 10) +'px';
         }
    resize();
    window.onresize = resize;
	  })()
//ç½‘æ˜“æ–¹æ¡ˆ
 (function () {
    var dpr = window.devicePixelRatio;
    function resize() {
      var deviceWidth = document.documentElement.clientWidth;
    document.documentElement.style.fontSize = (deviceWidth / 6.4) +'px';
   }
    resize();
    window.onresize = resize;
  })()

```



---

## ğŸŒ ä¸‰ã€æµè§ˆå™¨ä¸ç½‘ç»œ

#### æµè§ˆå™¨ä»è¾“å…¥ URL åˆ°é¡µé¢æ¸²æŸ“çš„å…¨è¿‡ç¨‹ï¼Ÿ
#### âœ…ï¸DOMã€CSSOMã€Render Tree çš„å…³ç³»ï¼Ÿ
DOM + CSSOM â†’ Render Tree â†’ Layout â†’ Paint
ä¸ºäº†é˜²æ­¢FOUCï¼ˆæ ·å¼é—ªçƒï¼‰ï¼Œæµè§ˆå™¨éœ€è¦å®Œæ•´çš„CSSOM treeæ‰èƒ½ç”Ÿæˆrender tree


#### âœ…ï¸é‡ç»˜ï¼ˆRepaintï¼‰ä¸å›æµï¼ˆReflowï¼‰åŒºåˆ«ï¼Ÿ

**å›æµ**ï¼šå½“æˆ‘ä»¬å¯¹ DOM çš„ä¿®æ”¹å¼•å‘äº† DOM å‡ ä½•å°ºå¯¸çš„å˜åŒ–ï¼ˆæ¯”å¦‚ä¿®æ”¹å…ƒç´ çš„å®½ã€é«˜æˆ–éšè—å…ƒç´ ç­‰ï¼‰æ—¶ï¼Œæµè§ˆå™¨éœ€è¦é‡æ–°è®¡ç®—å…ƒç´ çš„å‡ ä½•å±æ€§ï¼ˆå…¶ä»–å…ƒç´ çš„å‡ ä½•å±æ€§å’Œä½ç½®ä¹Ÿä¼šå› æ­¤å—åˆ°å½±å“ï¼‰ï¼Œç„¶åå†å°†è®¡ç®—çš„ç»“æœç»˜åˆ¶å‡ºæ¥ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å›æµï¼ˆä¹Ÿå«é‡æ’ï¼‰ã€‚

**é‡ç»˜**ï¼šå½“æˆ‘ä»¬å¯¹ DOM çš„ä¿®æ”¹å¯¼è‡´äº†æ ·å¼çš„å˜åŒ–ã€å´å¹¶æœªå½±å“å…¶å‡ ä½•å±æ€§ï¼ˆæ¯”å¦‚ä¿®æ”¹äº†é¢œè‰²æˆ–èƒŒæ™¯è‰²ï¼‰æ—¶ï¼Œæµè§ˆå™¨ä¸éœ€é‡æ–°è®¡ç®—å…ƒç´ çš„å‡ ä½•å±æ€§ã€ç›´æ¥ä¸ºè¯¥å…ƒç´ ç»˜åˆ¶æ–°çš„æ ·å¼ï¼ˆè·³è¿‡äº†ä¸Šå›¾æ‰€ç¤ºçš„å›æµç¯èŠ‚ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹å«åšé‡ç»˜ã€‚

å¼•å‘å›æµçš„æ“ä½œï¼š
- æ”¹å˜DOMå…ƒç´ çš„å‡ ä½•å±æ€§ï¼ˆwidthã€heightã€paddingã€marginã€leftã€topã€borderç­‰ï¼‰
- æ”¹å˜DOMç»“æ„ï¼Œå¦‚å¢åˆ ç§»åŠ¨èŠ‚ç‚¹
- è·å–éœ€è¦å³æ—¶ç»“ç®—å±æ€§çš„å€¼ï¼ˆå¦‚offsetTopã€offsetLeftã€scrollTopã€clientTopã€clientWidthç­‰ï¼‰
- è°ƒç”¨`getComputedStyle`æ–¹æ³•

é¿å…å›æµæ“ä½œï¼š
- è®¡ç®—æ—¶é¿å…å¤šæ¬¡è·å–æ•æ„Ÿå±æ€§ï¼Œä½¿ç”¨JSå˜é‡ä¿å­˜èµ·æ¥ï¼Œè®¡ç®—å®Œæ¯•åç»Ÿä¸€ä¿®æ”¹
- é¿å…é€æ¡ä¿®æ”¹æ ·å¼ï¼Œè€Œæ˜¯ä½¿ç”¨ç±»åå»åˆå¹¶ä»–ä»¬
- ä½¿ç”¨`display:none`å°†DOMç¦»çº¿ï¼Œæ“ä½œå®Œæˆåå†æ”¾å›å»

ç°ä»£æµè§ˆå™¨æœ‰flushé˜Ÿåˆ—ï¼Œä¼šåˆå¹¶åŒæ—¶è¿›è¡Œçš„`layout`å’Œ`paint`ï¼Œä½†é‡åˆ°è·å–åŠæ—¶è®¡ç®—å€¼æ—¶è¿™ä¸ªä¼˜åŒ–å°±æ— æ•ˆäº†ã€‚
#### âœ…ï¸ä»€ä¹ˆæ˜¯ BFCï¼Ÿè§¦å‘ BFC çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ

å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹æ¸²æŸ“åŒºåŸŸï¼Œå†…éƒ¨çš„block Boxä¸è¯¥åŒºåŸŸå¤–éƒ¨æ— å…³ï¼Œæ ¸å¿ƒç‰¹æ€§ï¼š
- å‚ç›´æ’åˆ—ï¼Œé—´è·ç”±marginå†³å®šï¼ˆé»˜è®¤é˜»æ­¢marginé‡å ï¼‰
- å†…éƒ¨æµ®åŠ¨å…ƒç´ å‚ä¸é«˜åº¦è®¡ç®—ï¼ˆæ¸…é™¤æµ®åŠ¨ï¼‰
è§¦å‘æ–¹å¼ï¼š
- float: left/right
- position: absolute/fixed
- display:inline-block/flex/grid/table-cell
- overflow:hidden/auto/scrollï¼ˆévisible)
- contain:layout/content/paint
ä½¿ç”¨åœºæ™¯ï¼š
- è§£å†³marginé‡å é—®é¢˜
- æ¸…é™¤æµ®åŠ¨ï¼ˆçˆ¶å…ƒç´ é«˜åº¦å¡Œé™·ï¼‰
- é˜»æ­¢æ–‡å­—ç¯ç»•æµ®åŠ¨å…ƒç´ 
#### âœ…ï¸å¦‚ä½•å®ç°ä¸€ä¸ªå‚ç›´æ°´å¹³å±…ä¸­ï¼Ÿ
1. å·²çŸ¥å®½é«˜ï¼Œç»å¯¹å®šä½+è¾¹è·åå‘åç§»ï¼š
	- position:absolute
	- width:100px
	- height:100px
	- left:50%
	- top:50%
	- margin:-50px 0 0 -50px
2. ä¸Šè¿°marginæ”¹æˆåŠ¨ç”»ï¼štransform: translate(-50%,-50%)
3. display:flex,align-items:center,justify-content:center
4. ç»å¯¹å®šä½+ä¸Šä¸‹å·¦å³å€¼ç›¸ç­‰ï¼Œæœ€åmargin:auto
5. å•è¡Œæ–‡æœ¬ï¼šè®¾ç½®line-height = height
6. å¤šè¡Œæ–‡æœ¬ï¼šçˆ¶å…ƒç´ tableï¼Œå­å…ƒç´ table-cellï¼Œvertical-align:middle

#### âœ…ï¸`flex: 1` æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿä¸ `auto` çš„åŒºåˆ«ï¼Ÿ
flexæ˜¯flex-growã€flex-shrinkã€flex-basisçš„ç®€å†™ã€‚
- flex-growï¼šä»¥basisä¸ºåŸºç¡€ï¼Œåœ¨ä¸»è½´ä¸Šå¢é•¿å°ºå¯¸ï¼ˆå‰©ä½™ç©ºé—´ï¼‰çš„æ¯”ä¾‹ã€‚è®¾ç½®ä¸º0æ—¶ï¼Œä»£è¡¨ä¿æŒå…ƒç´ åˆå§‹å®½åº¦ï¼Œä¸åˆ©ç”¨å‰©ä½™ç©ºé—´ã€‚
- flex-shrinkï¼šä»¥basisä¸ºåŸºç¡€ï¼Œåœ¨ä¸»è½´ä¸Šç¼©å°å°ºå¯¸çš„æ¯”ä¾‹ã€‚é»˜è®¤ä¸º1ï¼Œå³å¦‚æœç©ºé—´ä¸è¶³ï¼Œé¡¹ç›®å°†ç¼©å°ã€‚
- flex-basisï¼šåœ¨åˆ†é…ç©ºé—´ä¹‹å‰ï¼Œé¡¹ç›®åœ¨ä¸»è½´ä¸Šçš„åŸºç¡€å®½åº¦/é«˜åº¦ã€‚æµè§ˆå™¨å°†æ ¹æ®è¿™ä¸ªå±æ€§è®¡ç®—ä¸»è½´çš„å¤šä½™ç©ºé—´ï¼Œé»˜è®¤ä¸º`auto`ï¼Œå³é¡¹ç›®åŸæœ¬å¤§å°ï¼Œå½“å®ƒè®¾ç½®ä¸º0æ—¶ï¼Œå®ƒå°±å¹²æ‰äº†åŸæœ¬çš„å®½åº¦ã€‚
flexå­é¡¹çš„å®½åº¦ = flex-grow / total flex-grow * available space + item width
flex:autoï¼šç­‰äºflex: 1 1 auto
flex:1ï¼šç­‰äºflex: 1 1 0
æ‰€ä»¥flexï¼š1çš„å«ä¹‰å°±æ˜¯å…ˆç”¨flex-basisï¼š0å¹²æ‰æ‰€æœ‰å…ƒç´ æœ¬èº«çš„å®½åº¦ï¼Œå¹³å‡åˆ†é…ç©ºé—´ã€‚
è€Œflexï¼šautoä¼šæ ¹æ®è‡ªå·±å†…å®¹æ¥æ”¾å¤§ç¼©å°ï¼Œæ‰€ä»¥ä¼šå‡ºç°å…ƒç´ å¤§å°ä¸ä¸€æ ·çš„æƒ…å†µã€‚

#### âœ…ï¸æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶æœ‰å“ªäº›ï¼ŸåŒºåˆ«ï¼Ÿå¼ºç¼“å­˜ä¸åå•†ç¼“å­˜çš„å®ç°æ–¹å¼ï¼Ÿ
æµè§ˆå™¨æœ‰å››ç§ç¼“å­˜ï¼ŒæŒ‰ç…§è·å–èµ„æºæ—¶è¯·æ±‚ä¼˜å…ˆçº§æ’åˆ—å¦‚ä¸‹ï¼š
1. Memory Cache
2. Service Worker Cache
3. HTTP Cache
4. Push Cache
![image.png](https://raw.githubusercontent.com/exwer/img_bed/master/picGo/20250709234246.png)

##### HTTPå¼ºç¼“å­˜
å¼ºç¼“å­˜ï¼šé€šè¿‡å“åº”å¤´ä¸­çš„`Expires`å’Œ`Cache-Control`ä¸¤ä¸ªå­—æ®µæ¥æ§åˆ¶ã€‚
å¼ºç¼“å­˜å‘½ä¸­æ—¶ï¼Œhttp status codeä¸º200ï¼Œæœ‰`from disk cache`æ ‡è¯†ã€‚
```
Response Headers
	cache-control: max-age=31535000
	expires: Wed, 11 Sep 2019 16:12:18 GMT
	...
```
å¦‚æœæœ¬åœ°æ—¶é—´æ²¡åˆ°expiresè§„å®šçš„æ—¶é—´ï¼Œåˆ™å‘½ä¸­å¼ºç¼“å­˜ï¼Œä½†æ˜¯æœ¬åœ°æ—¶é—´å’ŒæœåŠ¡å™¨æ—¶é—´å¯èƒ½æœ‰æ—¶å·®ï¼Œè¿™ä¼šå¯¼è‡´å®ƒä¸å‡†ã€‚
http1.1æ¨å‡ºäº†Cache-control:max-ageï¼Œå•ä½æ˜¯ç§’ï¼Œç”±äºå®ƒæ˜¯å®¢æˆ·ç«¯ç›¸å¯¹æ—¶é—´ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æ—¶å·®é—®é¢˜ã€‚
`Cache-Control`çš„ä¼˜å…ˆçº§å¤§äº`expires`ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨ï¼Œå…¼å®¹è€æµè§ˆå™¨ã€‚
`Cache-Control:no-store`ï¼šä¸ä½¿ç”¨ä»»ä½•ç¼“å­˜ç­–ç•¥ã€‚
#####  HTTPåå•†ç¼“å­˜
`Cache-Control:no-cache`ï¼šåªä½¿ç”¨åå•†ç¼“å­˜ã€‚
åå•†ç¼“å­˜æœºåˆ¶ä¸‹ï¼Œæµè§ˆå™¨å‘æœåŠ¡å™¨è¯¢é—®ç¼“å­˜ç›¸å…³ä¿¡æ¯ï¼Œå†³å®šæ˜¯é‡æ–°ä¸‹è½½è¿˜æ˜¯åˆ©ç”¨æœ¬åœ°ç¼“å­˜ã€‚
åå•†ç¼“å­˜å‘½ä¸­ç¼“å­˜çš„æƒ…å†µä¸‹ï¼ŒHTTP status codeä¸º 304ï¼Œæ ‡è¯†`Not Modified`ã€‚
1. æœåŠ¡å™¨ä¸»å¯¼
```javascript
res.setHeader("ETag",'abc123') //å¼€å¯åå•†ç¼“å­˜
res.setHeader("Cache-Control","no-cache") //å¯é€‰ï¼Œç¦ç”¨å¼ºç¼“å­˜
```
2. æµè§ˆå™¨è‡ªåŠ¨å¤„ç†
	- æ£€æµ‹åˆ°`ETag`æˆ–`Last-Modified`å“åº”å¤´æ—¶ï¼Œæµè§ˆå™¨å¼€å¯åå•†ç¼“å­˜
	- åç»­è¯·æ±‚è‡ªå¸¦`If-None-Match`æˆ–`If-Modified-Since`
		- å¦‚æœæ˜¯`ETag`ï¼Œåˆ™`If-None-Match`ä¸ºä¸Šä¸€æ¬¡`ETag`
		- å¦‚æœæ˜¯`Last-Modified`ï¼Œåˆ™`If-Modified-Since`ä¸ºä¸Šæ¬¡å“åº”æ—¶`Last-Modified`çš„å€¼
		- `ETag`ä¼˜å…ˆçº§é«˜äº`Last-Modified`
			- `Last-Modified`ä»¥ç§’ä¸ºå•ä½ï¼Œä¸€ç§’å†…çš„å“åº”å˜åŠ¨æ— æ³•å¯Ÿè§‰
			- å¯¹äºä¿®æ”¹äº†æ–‡ä»¶ï¼Œä½†æ˜¯å†…å®¹ä¸å˜çš„æƒ…å†µï¼Œ`Last-Modified`æ— æ³•å¯Ÿè§‰
			- æœåŠ¡å™¨æ—¶é—´ä¸åŒæ­¥é—®é¢˜
		
3. ç”¨æˆ·å¯æ“ä½œå¤„ç†
	1. æ™®é€šåˆ·æ–°(F5)ï¼šè§¦å‘åå•†ç¼“å­˜æ£€æŸ¥
	2. å¼ºåˆ¶åˆ·æ–°(Ctrl+F5)ï¼šç»•è¿‡åå•†ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚æ–°æ•°æ®ï¼ˆæµè§ˆå™¨æ·»åŠ no-cacheå“åº”å¤´ï¼‰
	3. æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜ï¼šæ‰€æœ‰ç¼“å­˜åŒ…æ‹¬Etagéƒ½è¢«åˆ äº†
	4. éšèº«æ¨¡å¼ï¼šç¦ç”¨ç£ç›˜ç¼“å­˜ï¼ˆå†…å­˜ç¼“å­˜ä¾ç„¶å¯ç”¨ï¼‰
4. é€‚ç”¨åœºæ™¯ï¼Œæ ¸å¿ƒåŸåˆ™ï¼šå¸¦å®½èŠ‚çœæ”¶ç›Š > è®¡ç®—/æŸ¥è¯¢å¼€é”€ï¼ˆæ•°æ®åº“æŸ¥è¯¢ã€ETagè®¡ç®—ã€ç½‘ç»œä¼ è¾“ï¼‰
	- å¤§å“åº”ä½“+ä½æ›´æ–°é¢‘ç‡ï¼ˆçœå¸‚åŒºåˆ—è¡¨æ¥å£ï¼‰
	- æ•æ„Ÿæ•°æ®ï¼ˆç”¨æˆ·æ•°æ®ï¼šé¿å…æ•æ„Ÿæ•°æ®é¢‘ç¹ä¼ è¾“ï¼‰
	- é«˜é¢‘è¯» + ä½é¢‘å†™ï¼ˆæ–°é—»ï¼‰
##### ç­–ç•¥
ç›´æ¥ä½¿ç”¨`nginx`é…ç½®è‡ªåŠ¨ç®¡ç†`ETag`ï¼Œé…ç½®æ ¸å¿ƒåŸåˆ™ï¼šå¸¦å“ˆå¸Œçš„é™æ€æ–‡ä»¶ä½¿ç”¨`å¼ºç¼“å­˜+é•¿max-age`ï¼Œå…¶ä»–é™æ€æ–‡ä»¶å¼€å¯`ETag`ï¼Œä¸€èˆ¬å‰ç«¯çš„htmlã€cssã€jséƒ½é»˜è®¤ä½¿ç”¨å¼ºç¼“å­˜ç­–ç•¥ã€‚
ä¸¾ä¾‹ï¼š
```nginx
# /etc/nginx/conf.d/static_cache.conf
map $uri $cache_policy {
  # å¸¦å“ˆå¸Œæ–‡ä»¶ï¼š1å¹´å¼ºç¼“å­˜
  ~* \.[a-f0-9]{8}\.   "public, max-age=31536000, immutable";
  
  # å›¾ç‰‡å­—ä½“ï¼š30å¤©
  ~* \.(woff2?|ttf|eot|png|jpe?g|gif|webp|avif)$ 
                          "public, max-age=2592000";
  
  # é»˜è®¤ï¼š5åˆ†é’Ÿå¼ºç¼“å­˜+å¿…é¡»éªŒè¯
  default                "public, max-age=300, must-revalidate";
}

server {
  etag on; # å¯ç”¨è‡ªåŠ¨ETag
  if_modified_since before; # ç²¾ç¡®æ—¶é—´æ¯”å¯¹

  location / {
    # åº”ç”¨ç¼“å­˜ç­–ç•¥
    add_header Cache-Control $cache_policy;
    
    # ç¦ç”¨HTMLç¼“å­˜ï¼ˆSPAå…¥å£ï¼‰
    if ($uri = /index.html) {
      add_header Cache-Control "no-store, no-cache, must-revalidate";
    }
    
    # é™æ€æ–‡ä»¶æœåŠ¡
    root /var/www;
    try_files $uri $uri/ =404;
  }
}
```

#### âœ…ï¸HTTP çŠ¶æ€ç 

![image.png](https://raw.githubusercontent.com/exwer/img_bed/master/picGo/20250710041036.png)

#### âœ…ï¸Cookieã€SessionStorageã€LocalStorage åŒºåˆ«ï¼Ÿ
```
cookie:
- å¤§å°4kbå·¦å³
- å¯ç”±httpè¯·æ±‚ä¼ ç»™æœåŠ¡å™¨
- å®¢æˆ·ç«¯ã€æœåŠ¡å™¨å‡å¯æ“ä½œ
	- å®¢æˆ·ç«¯é€šè¿‡document.cookieï¼ˆæœªè®¾ç½®HttpOnlyæ—¶ï¼‰
	- ä»…httpsç¯å¢ƒï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥é€šè¿‡cookieStore(getã€setã€getAllã€delete)
	- æœåŠ¡å™¨é€šè¿‡Set-Cookieå“åº”å¤´è®¾ç½®cookie
- å¯ä½¿ç”¨Expireså’ŒMax-Ageè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè‹¥æœªè®¾ç½®ï¼Œæµè§ˆå™¨å…³é—­æ—¶åˆ é™¤cookie
- åŒåŸŸçš„ä¸åŒé¡µé¢å’Œå­åŸŸä¸­å…±äº«
- å¯è®¾ç½®HttpOnlyç¦æ­¢JSè®¿é—®ï¼Œå¯é€šè¿‡Secureæ ‡å¿—ä»…å…è®¸httpså‘é€
- å¯è®¾ç½®dominå­—æ®µï¼Œè¡¨ç¤ºå…è®¸è¯¥åŸŸçš„æ‰€æœ‰å­åŸŸæºå¸¦cookieï¼Œå¯ç”¨äºå•ç‚¹ç™»å½•

localStorage
- æ¯ä¸ªæ¥æºå¤§å°5mb
- å®¢æˆ·ç«¯é€šè¿‡localStorage.getItem/.setItem/.removeItem/.clearæ“ä½œ
- ç”¨æˆ·ã€ä»£ç ä¸åˆ é™¤ï¼Œåˆ™æ°¸ä¹…å­˜åœ¨ï¼ˆç£ç›˜æŒä¹…åŒ–ï¼‰
- åŒæºç½‘ç«™å¯ä»¥è®¿é—®

sessionStorage
- æ¯ä¸ªæ¥æºå¤§å°5mb
- é¡µé¢ä¼šè¯ç»“æŸæ—¶ï¼ˆæµè§ˆå™¨ã€é€‰é¡¹å¡å…³é—­ï¼‰æ•°æ®è¢«é”€æ¯ã€‚é‡æ–°åŠ è½½é¡µé¢ï¼Œæ•°æ®ä¸ä¼šé”€æ¯
- æ•°æ®åªåœ¨å½“å‰é€‰é¡¹å¡ä¸­å¯ä»¥è®¿é—®
```
#### âœ…ï¸å¦‚ä½•å®ç°è·¨åŸŸï¼ŸåŒæºç­–ç•¥ï¼Ÿ
##### CORS
åŸç†æ˜¯æœåŠ¡å™¨é€šè¿‡å“åº”å¤´å‘Šè¯‰æµè§ˆå™¨æˆ‘å…è®¸å“ªäº›æºè®¿é—®è¿™ä¸ªèµ„æºï¼š
- **è¯·æ±‚å¤´ (ç”±æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ )ï¼š**
    - `Origin`: è¡¨æ˜è¯·æ±‚æ¥è‡ªå“ªä¸ªæº (åè®® + ä¸»æœº + ç«¯å£)ã€‚æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ ï¼Œæ— æ³•é€šè¿‡ JavaScript ä¿®æ”¹ã€‚
- **å“åº”å¤´ (ç”±æœåŠ¡å™¨è®¾ç½®)ï¼š**
    - `Access-Control-Allow-Origin`Â (**å¿…éœ€**): æŒ‡å®šå“ªäº›æºè¢«å…è®¸è®¿é—®èµ„æºã€‚å€¼å¯ä»¥æ˜¯å…·ä½“çš„æº (å¦‚Â `https://app.example.com`) æˆ–é€šé…ç¬¦Â `*`Â (è¡¨ç¤ºå…è®¸**ä»»ä½•**æºè®¿é—®ï¼Œä½†**ä¸èƒ½**ä¸Â `Access-Control-Allow-Credentials: true`Â åŒæ—¶ä½¿ç”¨)ã€‚
    - `Access-Control-Allow-Methods`: æŒ‡å®šå…è®¸çš„ HTTP æ–¹æ³• (å¦‚Â `GET, POST, PUT, DELETE, OPTIONS`)ã€‚
    - `Access-Control-Allow-Headers`: æŒ‡å®šå…è®¸å®¢æˆ·ç«¯æºå¸¦çš„éç®€å•è¯·æ±‚å¤´ (å¦‚Â `Content-Type`,Â `Authorization`,Â `X-Custom-Header`)ã€‚
    - `Access-Control-Allow-Credentials`Â (å¸ƒå°”å€¼): è¡¨ç¤ºæ˜¯å¦å…è®¸æµè§ˆå™¨åœ¨è¯·æ±‚ä¸­å‘é€å‡­æ® (å¦‚ Cookiesã€HTTP è®¤è¯ä¿¡æ¯)ã€‚å¦‚æœè®¾ä¸ºÂ `true`ï¼Œåˆ™Â `Access-Control-Allow-Origin`Â **ä¸èƒ½**Â æ˜¯Â `*`ï¼Œå¿…é¡»æ˜¯å…·ä½“çš„æºã€‚
    - `Access-Control-Expose-Headers`: æŒ‡å®šå“ªäº›å“åº”å¤´å¯ä»¥è¢«å®¢æˆ·ç«¯ JavaScript è®¿é—® (é»˜è®¤åªèƒ½è®¿é—® Cache-Control, Content-Language, Content-Type, Expires, Last-Modified, Pragma)ã€‚
    - `Access-Control-Max-Age`: æŒ‡å®šé¢„æ£€è¯·æ±‚ (Preflight) çš„ç»“æœå¯ä»¥è¢«ç¼“å­˜å¤šä¹… (ç§’)ã€‚
CORSä½¿ç”¨ä¸¾ä¾‹ï¼š
```javascript
const allowedOrigins = [
  'https://example.com',
  'https://api.example.com',
  'http://localhost:3000'
];

app.use((req, res, next) => {
  const origin = req.headers.origin;
  if (allowedOrigins.includes(origin)) {
    res.set('Access-Control-Allow-Origin', origin); // åŠ¨æ€è¿”å›åŒ¹é…çš„æº
    res.set('Vary', 'Origin'); // å‘Šè¯‰æµè§ˆå™¨å“åº”ä¼šæ ¹æ® Origin å˜åŒ–
  }
  next();
});
```

##### å…¶ä»–æ–¹æ³•
- JSONPï¼š
	-  **åŸç†ï¼š**Â åˆ©ç”¨Â `<script>`Â æ ‡ç­¾ä¸å— SOP é™åˆ¶çš„ç‰¹æ€§æ¥æ¨¡æ‹Ÿè·¨åŸŸ GET è¯·æ±‚ã€‚å®ƒåªèƒ½ç”¨äºÂ **GET**Â è¯·æ±‚ã€‚
	- **æµç¨‹ï¼š**
	    1. å®¢æˆ·ç«¯å®šä¹‰ä¸€ä¸ªå…¨å±€å›è°ƒå‡½æ•° (å¦‚Â `handleResponse`)ã€‚
	    2. åŠ¨æ€åˆ›å»ºä¸€ä¸ªÂ `<script>`Â æ ‡ç­¾ï¼Œå…¶Â `src`Â è®¾ç½®ä¸ºç›®æ ‡ API URLï¼Œå¹¶åœ¨ URL ä¸­æŒ‡å®šå›è°ƒå‡½æ•°åä½œä¸ºå‚æ•° (å¦‚Â `?callback=handleResponse`)ã€‚
	    3. æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œ**ä¸æ˜¯è¿”å› JSON**ï¼Œè€Œæ˜¯è¿”å›ä¸€æ®µÂ **JavaScript ä»£ç **ã€‚è¿™æ®µä»£ç çš„å†…å®¹æ˜¯**è°ƒç”¨å®¢æˆ·ç«¯æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå¹¶å°†çœŸæ­£çš„ JSON æ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¯¥å‡½æ•°**Â (å¦‚Â `handleResponse({"data": "value"});`)ã€‚
	    4. æµè§ˆå™¨åŠ è½½å¹¶æ‰§è¡Œè¯¥Â `<script>`Â æ ‡ç­¾è¿”å›çš„ JS ä»£ç ï¼Œä»è€Œè°ƒç”¨é¢„å®šä¹‰çš„å›è°ƒå‡½æ•°Â `handleResponse`ï¼Œå¹¶å°†æœåŠ¡å™¨æ•°æ®ä¼ é€’ç»™å®ƒã€‚
	    5. å®¢æˆ·ç«¯åœ¨Â `handleResponse`Â å‡½æ•°ä¸­å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®ã€‚
	- **ä¼˜ç‚¹ï¼š**Â å…¼å®¹æ€§æä½³ï¼ˆæ”¯æŒæ‰€æœ‰æ”¯æŒ JS çš„å¤è€æµè§ˆå™¨ï¼‰ã€æ— éœ€æœåŠ¡å™¨è¿›è¡Œç‰¹æ®Š CORS é…ç½®ï¼ˆä½†æœåŠ¡å™¨éœ€è¦æ”¯æŒ JSONP æ ¼å¼ï¼‰ã€‚
	- **ç¼ºç‚¹ï¼š**
	    - **ä»…æ”¯æŒ GET è¯·æ±‚ã€‚**
	    - **å®‰å…¨æ€§å·®ï¼š**Â å®Œå…¨ä¿¡ä»»æœåŠ¡å™¨è¿”å›çš„ä»£ç ã€‚å¦‚æœæœåŠ¡å™¨è¢«æ”»ç ´æˆ–è¢«æ¶æ„åˆ©ç”¨ï¼Œè¿”å›çš„ JS ä»£ç å¯ä»¥åœ¨å®¢æˆ·ç«¯æ‰§è¡Œä»»æ„æ“ä½œï¼ˆXSS é£é™©ï¼‰ã€‚éš¾ä»¥è¿›è¡Œé”™è¯¯å¤„ç†ï¼ˆåªèƒ½ä¾èµ–è¶…æ—¶ï¼‰ã€‚
	    - ç¼ºä¹åƒÂ `fetch`Â / XHR é‚£æ ·çš„ç»†ç²’åº¦æ§åˆ¶å’ŒçŠ¶æ€ç å¤„ç†ã€‚
	    - è¿åäº† "èµ„æºå³æ•°æ®" çš„ REST åŸåˆ™ï¼Œè¿”å›çš„æ˜¯å¯æ‰§è¡Œä»£ç ã€‚
- æœåŠ¡å™¨ä»£ç†ï¼šä¾‹å¦‚dev-server
- Websocket
- window.postmessageï¼š
	- ä¼˜ç‚¹ï¼šå¯ä»¥è·¨åŸŸã€‚
	- ç¼ºç‚¹ï¼šåªé€‚ç”¨äºçª—å£/æ–‡æ¡£é—´çš„é€šä¿¡ï¼Œä¸èƒ½ç”¨äºæ™®é€šçš„ AJAX/Fetch è¯·æ±‚åˆ°æœåŠ¡å™¨ APIã€‚
##### ç®€å•è¯·æ±‚å’Œå¤æ‚è¯·æ±‚
- **ç®€å•è¯·æ±‚ (Simple Request):**
    - æ–¹æ³•ä¸ºÂ `GET`,Â `HEAD`,Â `POST`ã€‚
    - å…è®¸çš„è¯·æ±‚å¤´ä»…é™äºï¼š`Accept`,Â `Accept-Language`,Â `Content-Language`,Â `Content-Type`Â (å€¼ä»…é™äºÂ `application/x-www-form-urlencoded`,Â `multipart/form-data`,Â `text/plain`)ã€‚
    - æ²¡æœ‰ä½¿ç”¨Â `ReadableStream`Â å¯¹è±¡ã€‚
    - **æµç¨‹ï¼š**Â æµè§ˆå™¨ç›´æ¥å‘é€å®é™…è¯·æ±‚ã€‚æœåŠ¡å™¨å“åº”ä¸­å¿…é¡»åŒ…å«Â `Access-Control-Allow-Origin`Â å¤´ï¼ˆä¸”å€¼åŒ¹é…è¯·æ±‚çš„Â `Origin`Â æˆ–ä¸ºÂ `*`ï¼‰ã€‚å¦‚æœè¯·æ±‚éœ€è¦å‡­æ®ï¼ŒæœåŠ¡å™¨è¿˜å¿…é¡»åŒ…å«Â `Access-Control-Allow-Credentials: true`ã€‚
- **é¢„æ£€è¯·æ±‚ (Preflight Request):**
    - ä¸ç¬¦åˆç®€å•è¯·æ±‚æ¡ä»¶çš„è¯·æ±‚ï¼ˆå¦‚ä½¿ç”¨äº†Â `PUT`,Â `DELETE`,Â `PATCH`Â æ–¹æ³•ï¼›`Content-Type`Â ä¸ºÂ `application/json`ï¼›æºå¸¦äº†è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼‰ã€‚
    - **æµç¨‹ï¼š**
        1. æµè§ˆå™¨åœ¨å‘é€å®é™…è¯·æ±‚**ä¹‹å‰**ï¼Œè‡ªåŠ¨å‘é€ä¸€ä¸ªÂ `OPTIONS`Â æ–¹æ³•çš„**é¢„æ£€è¯·æ±‚**åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
        2. é¢„æ£€è¯·æ±‚æºå¸¦Â `Origin`,Â `Access-Control-Request-Method`Â (å®é™…è¯·æ±‚å°†ä½¿ç”¨çš„æ–¹æ³•),Â `Access-Control-Request-Headers`Â (å®é™…è¯·æ±‚å°†æºå¸¦çš„éç®€å•å¤´)ã€‚
        3. æœåŠ¡å™¨æ£€æŸ¥é¢„æ£€è¯·æ±‚çš„å¤´éƒ¨ï¼Œå†³å®šæ˜¯å¦å…è®¸å®é™…è¯·æ±‚ã€‚
        4. æœåŠ¡å™¨å“åº”é¢„æ£€è¯·æ±‚ï¼ŒåŒ…å«Â `Access-Control-Allow-Origin`,Â `Access-Control-Allow-Methods`,Â `Access-Control-Allow-Headers`Â ç­‰ã€‚å¦‚æœå…è®¸å‡­æ®ï¼Œè¿˜éœ€åŒ…å«Â `Access-Control-Allow-Credentials: true`ã€‚
        5. **å…³é”®ç‚¹ï¼š**Â æœåŠ¡å™¨å¿…é¡»å¯¹Â `OPTIONS`Â æ–¹æ³•æœ¬èº«ä¹Ÿè¿”å›Â `200 OK`Â æˆ–Â `204 No Content`Â çŠ¶æ€ç ï¼Œ**å³ä½¿**è¯¥è·¯å¾„é€šå¸¸ä¸æ”¯æŒÂ `OPTIONS`ã€‚å¦åˆ™é¢„æ£€å¤±è´¥ã€‚
        6. æµè§ˆå™¨æ£€æŸ¥é¢„æ£€å“åº”å¤´ã€‚å¦‚æœæ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼Œæµè§ˆå™¨æ‰å‘é€å®é™…çš„è¯·æ±‚ã€‚å¦åˆ™ï¼Œæµè§ˆå™¨ç›´æ¥æŠ¥é”™ï¼ˆCORS é”™è¯¯ï¼‰ï¼Œä¸ä¼šå‘é€å®é™…è¯·æ±‚ã€‚
**æ€»ç»“é¢„æ£€è¯·æ±‚çš„å…³é”®ä½œç”¨ï¼š**
1. **å®‰å…¨é˜²æŠ¤ï¼š**Â é˜²æ­¢æ¶æ„ç½‘ç«™åˆ©ç”¨ SOP ä¸é˜»æ­¢è¯·æ±‚å‘é€çš„æ¼æ´ï¼Œåœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å‘è·¨åŸŸæœåŠ¡å™¨å‘é€å¯èƒ½é€ æˆæ•°æ®ç ´åçš„å¤æ‚è¯·æ±‚ï¼ˆå¦‚Â `DELETE`,Â `PUT`ï¼‰ã€‚
2. **æƒé™åå•†ï¼š**Â ä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨æä¾›ä¸€ç§æœºåˆ¶ï¼Œåœ¨å‘é€æ½œåœ¨å±é™©çš„å¤æ‚è·¨åŸŸè¯·æ±‚ä¹‹å‰ï¼Œæ˜ç¡®åå•†è¯¥è¯·æ±‚çš„æ¥æºã€æ–¹æ³•å’Œå¤´éƒ¨æ˜¯å¦è¢«ç›®æ ‡æœåŠ¡å™¨å…è®¸ã€‚
3. **é”™è¯¯é¢„é˜²ï¼š**Â ä¿æŠ¤æœªå¯ç”¨ CORS æˆ–æœªå¤„ç†ç‰¹å®šæ–¹æ³•/å¤´éƒ¨çš„ä¼ ç»ŸæœåŠ¡å™¨ï¼Œé¿å…æ”¶åˆ°æ— æ³•å¤„ç†çš„æ„å¤–è·¨åŸŸå¤æ‚è¯·æ±‚ã€‚
4. **æ•ˆç‡å¹³è¡¡ï¼š**Â é€šè¿‡ä»…å¯¹å¤æ‚è¯·æ±‚è¿›è¡Œé¢„æ£€ï¼Œåœ¨å®‰å…¨æ€§å’Œæ€§èƒ½ä¹‹é—´å–å¾—å¹³è¡¡ã€‚
#### âœ…ï¸HTTPS çš„æ¡æ‰‹æµç¨‹ï¼Ÿè¯ä¹¦ä½œç”¨ï¼Ÿå¦‚ä½•ç¡®è®¤è¯ä¹¦æœ‰æ•ˆæ€§ï¼Ÿå¦‚ä½•æŠ“åŒ…ï¼Ÿ
##### TLS1.2
clientç»™serverå‘é€httpsè¯·æ±‚(å’Œä¸€ä¸ªéšæœºæ•°)  -> serverè¿”å›è‡ªå·±çš„è¯ä¹¦(å«å…¬é’¥)å’Œserveréšæœºæ•° -> å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦ï¼Œç”¨ä¸¤è¾¹éšæœºæ•°ç”Ÿæˆå¯¹ç§°ç§˜é’¥ï¼Œå¹¶ç”¨å…¬é’¥åŠ å¯†ï¼Œä¼ ç»™æœåŠ¡å™¨ -> æœåŠ¡å™¨ç”¨ç§é’¥è§£å¯†æ‹¿åˆ°å¯¹ç§°å¯†é’¥ -> ä¸¤è¾¹äº’å‘`ChangeCipherSpec`è¡¨ç¤ºè¿›å…¥åŠ å¯†æ¨¡å¼

éšæœºæ•°ä¿è¯æ¯ä¸€æ¬¡æ¡æ‰‹åå•†å‡ºçš„å¯¹ç§°å¯†é’¥éƒ½ä¸ä¸€æ ·ã€‚
![image.png](https://raw.githubusercontent.com/exwer/img_bed/master/picGo/20250710051356.png)
##### TLS1.3
![image.png](https://raw.githubusercontent.com/exwer/img_bed/master/picGo/20250710051615.png)
**TLS 1.3 çš„è¯ä¹¦ä¸­é€šå¸¸ä»ç„¶ä½¿ç”¨ RSA å…¬é’¥ï¼ˆæˆ– ECC å…¬é’¥ï¼‰**ï¼Œä½†æ³¨æ„ï¼š
- è¯ä¹¦é‡Œçš„ RSA å…¬é’¥ç”¨æ¥ç­¾åå’ŒéªŒè¯æœåŠ¡å™¨èº«ä»½ï¼›
- å®é™…æ•°æ®ä¼ è¾“æ‰€ç”¨å¯†é’¥ç”± ECDHE åè®®ç”Ÿæˆï¼Œä¸è¯ä¹¦æ— å…³ã€‚

##### å¦‚ä½•éªŒè¯è¯ä¹¦æœ‰æ•ˆæ€§
æµè§ˆå™¨å†…ç½®äº†è¯ä¹¦é“¾ã€‚
![image.png](https://raw.githubusercontent.com/exwer/img_bed/master/picGo/20250710051927.png)
##### å¦‚ä½•æŠ“åŒ…
å®‰è£…charlesçš„è¯ä¹¦å¹¶ä¿¡ä»»ï¼Œç”±charlesè¿›è¡Œåˆæ³•çš„`ä¸­é—´äººæ”»å‡»`ã€‚
#### âœ…ï¸å‰ç«¯å¦‚ä½•å¤„ç†å›¾ç‰‡æ‡’åŠ è½½ï¼Ÿ
æ–¹æ³•ä¸€ï¼š`<img loading="lazy" />`
æ–¹æ³•äºŒï¼š
```javascript
const observer = new IntersecctionObserver(entries=>{
	entries.forEach((item)=>{
		if(item.isIntersecting){
			const img = item.target
			const realSrc = img.dataset.src
			img.src = realSrc
			observer.unobserve(img)
		}
	},{
		rootMargin: '50px' //æå‰åŠ è½½çš„ç¼“å†²åŒºåŸŸ
		threshold: 0.01 //è§¦å‘åŠ è½½çš„å¯è§æ¯”ä¾‹
	})
})
images.forEach(img=>observer.observe(img))
```
æ–¹æ³•ä¸‰ï¼š
å¾…åŠ è½½å›¾ç‰‡çš„åˆ°é¡µé¢é¡¶éƒ¨è·ç¦» < æµè§ˆlå™¨è§†çª—è·ç¦» + æ»šåŠ¨æ¡åˆ’è¿‡çš„è·ç¦»ï¼Œå³ä¸ºå¯è§
`offsetTop < innerHeight + scrollTop`
```javascript
function isVisible(el) {
  const rect = el.getBoundingClientRect();
  const windowHeight = window.innerHeight || document.documentElement.clientHeight;
  const windowWidth = window.innerWidth || document.documentElement.clientWidth;

  // åˆ¤æ–­æ˜¯å¦åœ¨è§†å£ä¸­ï¼ˆä¸Šä¸‹å·¦å³è‡³å°‘éƒ¨åˆ†å¯è§ï¼‰
  return (
    rect.top < windowHeight &&
    rect.bottom > 0 &&
    rect.left < windowWidth &&
    rect.right > 0
  );
}
const imgs = document.querySelectorAll('img[data-src]');

function lazyLoad() {
  imgs.forEach(img => {
    if (isVisible(img) && !img.dataset.loaded) {
      img.src = img.dataset.src;
      img.dataset.loaded = 'true';
    }
  });
}

window.addEventListener('scroll', throttle(lazyLoad, 200));
window.addEventListener('resize', throttle(lazyLoad, 200));
window.addEventListener('DOMContentLoaded', lazyLoad);

```

`scroll`æ–¹æ¡ˆç¼ºç‚¹ï¼š
- æ»šåŠ¨äº‹ä»¶é«˜é¢‘è§¦å‘
- éœ€è¦æ‰‹åŠ¨æ·»åŠ é˜²æŠ–ã€èŠ‚æµé€»è¾‘
- `getBoundingClientRect()`æ˜¯è®¡ç®—æ ·å¼ï¼Œä¼šå¼•å‘reflow

`IntersectionObserver`ä¼˜åŠ¿ï¼š
- æµè§ˆå™¨åŸç”Ÿä¼˜åŒ–ï¼Œè§¦å‘é¢‘ç‡è‡ªåŠ¨æ§åˆ¶
- å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
- æ— å¸ƒå±€æŠ–åŠ¨é£é™©
#### âœ…ï¸`defer` ä¸ `async` çš„åŒºåˆ«ï¼Ÿ
```
<script>çš„ä¸‹è½½å’Œæ‰§è¡Œéƒ½ä¼šé˜»å¡è§£ææµç¨‹
<script defer>
- å¼‚æ­¥ä¸‹è½½æ–‡ä»¶
- åœ¨domè§£æå®Œæˆåæ‰§è¡Œ(DOMContentLoadedä¹‹å‰)
- æŒ‰ç…§æ–‡æ¡£é¡ºåºä¾æ¬¡æ‰§è¡Œ
- å¯è®¿é—®å®Œæ•´dom
- é€‚ç”¨åœºæ™¯ï¼š1.éœ€è¦æ“ä½œdom 2.æœ‰å…ˆåä¾èµ–å…³ç³»éœ€è¦é¡ºåºæ‰§è¡Œ
<script async>
- å¼‚æ­¥ä¸‹è½½æ–‡ä»¶
- ä¸‹è½½å®Œåç«‹é©¬æ‰§è¡Œ(é˜»å¡è§£æ)
- æ— æ‰§è¡Œé¡ºåºï¼Œè°å…ˆä¸‹è½½å®Œè°æ‰§è¡Œ
- é€‚ç”¨åœºæ™¯ï¼š1.ç‹¬ç«‹å¤–éƒ¨è„šæœ¬ä¾‹å¦‚å¹¿å‘Š 2.æ— ä¾èµ–çš„æ¨¡å— 3.æ„å»ºå·¥å…·çš„å¼‚æ­¥chunk
```
### âœ…ï¸é¡µé¢ç”Ÿå‘½å‘¨æœŸ
- `window.load`ï¼šå½“æ•´ä¸ªé¡µé¢ï¼ŒåŒ…æ‹¬æ ·å¼ã€å›¾ç‰‡å’Œå…¶ä»–èµ„æºè¢«åŠ è½½å®Œæˆæ—¶ï¼Œä¼šè§¦å‘Â `window`Â å¯¹è±¡ä¸Šçš„Â `load`Â äº‹ä»¶ã€‚
- `window.beforeunload`ï¼šç”¨æˆ·æ“ä½œå¯¼èˆªæˆ–è€…è¯•å›¾ç¦»å¼€é¡µé¢è§¦å‘ï¼Œè®¾ç½®è¯¥äº‹ä»¶çš„`event.rekturnValue = â€˜æœ‰æœªä¿å­˜çš„ä¿¡æ¯ï¼Œç¡®è®¤ç¦»å¼€å—?â€™`ï¼Œé¡µé¢ä¼šåœ¨é€€å‡ºä¹‹å‰ç¡®è®¤ã€‚
- `window.unload`ï¼šç”¨æˆ·ç¦»å¼€é¡µé¢ï¼Œè§¦å‘`window.unload`äº‹ä»¶ã€‚æ­¤æ—¶å¯ä»¥å‘é€é¡µé¢ç»Ÿè®¡æ•°æ®ã€‚ä¾‹å¦‚ä½¿ç”¨`keepalive=true`çš„`fetch`ï¼ˆå…¨éƒ¨è¯·æ±‚bodyæ€»å’Œé•¿åº¦é™åˆ¶ä¸º64kbï¼‰æˆ–è€…`navigator.sendBeacon(url,data)`ï¼ˆpostè¯·æ±‚ï¼Œé™åˆ¶64kbï¼‰
-  `document.DOMContentloaded`ï¼šå½“ HTML æ–‡æ¡£å®Œå…¨è§£æï¼Œä¸”å»¶è¿Ÿè„šæœ¬ï¼ˆ[`<script defer src="â€¦">`](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Reference/Elements/script#defer)Â å’ŒÂ [`<script type="module">`](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Reference/Elements/script#module)ï¼‰ä¸‹è½½å’Œæ‰§è¡Œå®Œæ¯•åï¼Œä¼šè§¦å‘Â **`document.DOMContentLoaded`**Â äº‹ä»¶ã€‚å®ƒä¸ä¼šç­‰å¾…å›¾ç‰‡ã€å­æ¡†æ¶å’Œå¼‚æ­¥è„šæœ¬ç­‰å…¶ä»–å†…å®¹å®ŒæˆåŠ è½½ã€‚
- `document.readyState`ï¼šæœ‰æ—¶æˆ‘ä»¬ä¸ç¡®å®šæ–‡æ¡£æ˜¯å¦å°±ç»ªï¼Œæ­¤æ—¶ä½¿ç”¨`DOMContentloaded`å®ƒæœ‰å¯èƒ½æ°¸è¿œä¸ä¼šæ‰§è¡Œï¼ˆdomå·²ç»åŠ è½½å®Œæ¯•ï¼‰ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`readyState`ï¼Œå®ƒæœ‰ä¸‰ä¸ªå€¼ï¼š
	- `loading`ï¼šæ–‡æ¡£è¢«è¯»å–ä¸­
	- `interactive`ï¼šæ–‡æ¡£è¢«å…¨éƒ¨è¯»å–
	- `complete`ï¼šæ–‡æ¡£è¢«å…¨éƒ¨è¯»å–ï¼Œä¸”æ‰€æœ‰èµ„æºï¼ˆå¦‚å›¾ç‰‡ï¼‰åŠ è½½å®Œæˆ
è¯¥å±æ€§é…å¥—ä¸€ä¸ª`document.readystatechange`äº‹ä»¶ã€‚
#### æµè§ˆå™¨å¦‚ä½•é¢„åŠ è½½èµ„æºï¼Ÿ
#### WebSocket å’Œ SSE çš„åŒºåˆ«åŠåº”ç”¨åœºæ™¯ï¼Ÿ

---

## ğŸ”§ å››ã€æ¡†æ¶ä¸å·¥ç¨‹åŒ–ï¼ˆ14é¢˜ï¼‰

### Vue2 å’Œ Vue3 çš„å“åº”å¼åŸç†æœ‰ä½•ä¸åŒï¼Ÿ
### Composition API çš„è®¾è®¡åŠ¨æœºæ˜¯ä»€ä¹ˆï¼Ÿ
### Vue ç”Ÿå‘½å‘¨æœŸæœ‰å“ªäº›é˜¶æ®µï¼Ÿæœ‰å“ªäº›å˜åŒ–ï¼Ÿ
### `v-model` çš„åº•å±‚å®ç°åŸç†ï¼Ÿ
###  Vue ä¸­å¦‚ä½•å®ç°ç»„ä»¶é€šä¿¡ï¼Ÿ
### çˆ¶å­ç»„ä»¶ä¹‹é—´æ•°æ®æµå‘ï¼Ÿ
### Vuex ä¸ Pinia çš„åŒºåˆ«ï¼Ÿä¼˜åŠ£å¯¹æ¯”ï¼Ÿ
### è™šæ‹Ÿ DOM æ˜¯ä»€ä¹ˆï¼Ÿä¸çœŸå® DOM åŒºåˆ«ï¼Ÿ
### diff ç®—æ³•çš„åŸºæœ¬åŸç†ï¼Ÿ
###  Vite ä¸ Webpack çš„æ„å»ºå·®å¼‚ï¼Ÿ
### loader ä¸ plugin çš„åŒºåˆ«ï¼Ÿ
### å¦‚ä½•å®ç°ç»„ä»¶æŒ‰éœ€åŠ è½½ï¼Ÿå¦‚ä½• tree-shakingï¼Ÿ
### interface ä¸ type æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
###  TS ä¸ºä½•èƒ½æå‡é¡¹ç›®è´¨é‡ï¼Ÿè¿è¡Œæ—¶ä¸ç¼–è¯‘æ—¶çš„ä¼˜åŠ¿ï¼Ÿ
### tsconfig.jsonä¸d.ts

---

## ğŸ§® äº”ã€ç®—æ³•ä¸æ‰‹å†™ä»£ç ï¼ˆ16é¢˜ï¼‰

#### âœ…ï¸æ‰‹å†™æ·±æ‹·è´å‡½æ•°ï¼Œè€ƒè™‘ç‰¹æ®Šç±»å‹ä¸å¾ªç¯å¼•ç”¨
```javascript
function isPrimitiveOrFunction(val){
	return typeof val === 'function' || typeof val !== 'object' || typeof val === 'null'
}
function getType(value){
	return Object.prototype.toString.call(value).slice(8.-1).toLowerCase()
}
function deepClone(value, cache){
	//primitive or function -> return
	//object -> deepClone(key)
	//array -> .map(val=>deepClone(val))
	//Date -> new Date(val)
	//RegExp -> new RegExp(val)
	//Map -> new Map
	//Set -> new Set
	if(isPrimitiveOrFunction(value)){
		return value
	}
	const type = getType(value)
	if(type === 'set'){
		const cloned = new Set()
		value.forEach((val)=>{
			cloned.add(deepClone(val,cache))
		})
	}
	if(type === 'map'){
		const cloned = new Map()
		value.forEach((val,key)=>{
			clone.set(key, deepClone(val,cache))
		})
		return cloned
	}
	if(type === 'array'){
		return value.map(i=>deepClone(i,cache))
	}
	if(type === 'date'){
		return new Date(value)
	}
	if(type === 'regexp'){
		return new RegExp(value)
	}
	if(cache.has(value)){
		return cache.get(value)
	}
	const cloned = Object.create(Object.getPrototypeOf(value)) //å¤åˆ¶åŸå‹
	cache.set(value, cloned)
	//ä½¿ç”¨Reflectå¤åˆ¶ä¸å¯æšä¸¾å±æ€§
	for(const key of Reflect.ownKeys(value)){
		cloned[key] = deepClone(value[key],cache)
	}
	
}
deepClone(obj,new Map())
```
#### âœ…ï¸æ‰‹å†™èŠ‚æµï¼ˆthrottleï¼‰ä¸é˜²æŠ–ï¼ˆdebounceï¼‰
```javascript
function throttle(func,wait = 0){
	let shouldThrottle = false
	return function(...args){
		if(shouldThrottle){
			return
		}
		func.call(this,...args)
		shouldThrottle = true
		setTimeout(()=>{
			shouldThrottle = false
		},wait)
	}
}
throttle(sum,100)

function debounce(func,wait = 0){
	let timer = null
	return function(...args){
		clearTimeout(timer)
		timer = setTimeout(()=>{
			func.apply(this,args)
		},wait)	
	}
}
debounce(sum,100)
```
#### âœ…ï¸æ‰‹å†™ä¸€ä¸ª Promise ä¸²è¡Œæ‰§è¡Œå‡½æ•°
```javascript
function promiseSeries(tasks){
	return tasks.reduce((prevPromise,curTask)=>{
		return prevPromise.then(curTask)
	},Promise.resolve())
}
function promiseSeries2(tasks){
	return tasks.reduce((prevPromise,curTask)=>{
		return prevPromise.then(result=>{
			curTask().then(result2=>[...result,result2])
		})
	}
	,Promise.resolve([]))
}
```
#### âœ…ï¸æ‰‹å†™ curry å‡½æ•°ï¼ˆæŸ¯é‡ŒåŒ–ï¼‰
```javascript
function curry(func){
	return function curried(...args){
		if(args.length >= func.length){
			return func.apply(this,args)
		}
		return (...args2) => curried.apply(this,[...args,...args2])
	}
}

function sum(a,b,c){return a+b+c}
const cSum = curry(sum)
cSum(1)(2)(3) //6

cSum(1)
cSum(2)
cSum(3) // 6

cSum(1)
cSum(2,3) // 6
```
#### âœ…ï¸æ‰‹å†™ compose å‡½æ•°ï¼ˆå‡½æ•°ç»„åˆï¼‰
```javascript
const numberic = compose(Math.round,parseFloat)
numberic(3.56) // 4

function compose(...fns){
	return (arg)=>{
		return fns.reduceRight((prevVal,curFn)=>{
			return curFn(prevVal)	
		},arg)
	}
}
```
#### âœ…ï¸æ‰‹å†™ eventEmitterï¼ˆå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼‰
```javascript
class EventEmitter {
  constructor() {
    this.events = new Map()
    this.onceFlag = Symbol('once')
  }

  on(key, fn) {
    const list = this.events.get(key) || []
    list.push(fn)
    this.events.set(key, list)
  }

  once(key, fn) {
    fn[this.onceFlag] = true
    this.on(key, fn)
  }

  off(key, fn) {
    if (!fn) {
      this.events.delete(key)
    } else {
      const list = this.events.get(key)
      if (list) {
        this.events.set(key, list.filter(f => f !== fn))
      }
    }
  }

  emit(key, ...args) {
    const list = this.events.get(key)
    if (!list) return

    for (const fn of [...list]) {
      fn(...args)
      if (fn[this.onceFlag]) {
        this.off(key, fn)
      }
    }
  }
}


const eventBus = new EventEmitter()
eventBus.on('left',fn1)
eventBus.on('left',fn2)
eventBus.emit('left',2) // fn1(fn2(2))
eventBus.off('left') // clear all left listeners
eventBus.once('right',fn3)
eventBus.emit('right') //fn3 output
eventBus.emit('right') //Error
```
#### âœ…ï¸æ‰‹å†™ instanceof
```javascript
function sum(){}
console.log(sum instanceof Function) //true
function isPrimitive(val){
	return val === null || typeof val !== 'object' || typeof val!== 'function'
}
function myInstanceof(a,b){
	if(isPrimitive(a))return false
	if(!b.prototype)return false
	let proto = Obejct.getPrototypeOf(a)
	while(proto){
		if(proto === b.prototype)return true
		proto = Object.getPrototypeOf(proto) || null
	}
	return false
}
```
#### âœ…ï¸æ‰‹å†™ applyã€callã€bind å®ç°
```javascript
Function.prototype.call = function(context, ...args) {
  // 1. å¤„ç†ä¸Šä¸‹æ–‡ï¼šåŸå§‹å€¼è£…ç®± + é»˜è®¤å…¨å±€å¯¹è±¡ï¼ˆéä¸¥æ ¼æ¨¡å¼ï¼‰
  context = context ? Object(context) : (typeof window !== 'undefined' ? window : global);
  // 2. åˆ›å»ºå”¯ä¸€å±æ€§é”®
  const fnKey = Symbol('fn');
  // 3. ç»‘å®šå‡½æ•°åˆ°ä¸Šä¸‹æ–‡
  context[fnKey] = this;
  // 4. æ‰§è¡Œå¹¶ä¿å­˜ç»“æœ
  const result = context[fnKey](...args);
  // 5. æ¸…ç†ï¼ˆå³ä½¿ä¸¥æ ¼æ¨¡å¼æŠ¥é”™ä¹Ÿä¸å½±å“ç»“æœï¼‰
  try {
    delete context[fnKey];
  } catch (e) {}
  // 6. è¿”å›ç»“æœ
  return result;
};

Function.prototype.apply = function(context, argsArray) { // æ³¨æ„ï¼šç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•°ç»„
  // 1. å‚æ•°æ ¡éªŒï¼ˆè§„èŒƒè¦æ±‚argsArrayå¿…é¡»ä¸ºç±»æ•°ç»„å¯¹è±¡æˆ–undefined/nullï¼‰
  if (argsArray !== undefined && argsArray !== null && !isArrayLike(argsArray)) {
    throw new TypeError('CreateListFromArrayLike called on non-object');
  }

  // 2. å€Ÿç”¨å·²å®ç°çš„callæ–¹æ³•
  return this.call(context, ...(argsArray || [])); // å±•å¼€æ•°ç»„ä¸ºå‚æ•°åˆ—è¡¨
};
function isArrayLike(obj) {
  return obj && typeof obj.length === 'number' && obj.length >= 0;
}

// æµ‹è¯•ç”¨ä¾‹
function greet(greeting, punctuation) {
  return `${greeting}, ${this.name}${punctuation}`;
}
console.log(greet.apply({ name: 'Bob' }, ['Hello', '!'])); // "Hello, Bob!"

Function.prototype.bind = function(context, ...bindArgs) {
  const originalFunc = this;
  
  // è¿”å›ç»‘å®šå‡½æ•°
  return function boundFn(...callArgs) {
    // åˆ¤æ–­æ˜¯å¦ä½œä¸ºæ„é€ å‡½æ•°ï¼ˆé€šè¿‡newè°ƒç”¨ï¼‰
    const isNewCall = this instanceof boundFn;
    
    // å¦‚æœæ˜¯newè°ƒç”¨ï¼Œå¿½ç•¥ç»‘å®šçš„contextï¼ˆä¿ç•™newçš„thisï¼‰
    return originalFunc.call(
      isNewCall ? this : context,
      ...bindArgs, ...callArgs
    );
  };
};

// æµ‹è¯•ç”¨ä¾‹
const person = { name: 'Alice' };
function introduce(greeting, age) {
  console.log(`${greeting}, I'm ${this.name}, ${age} years old`);
}

// åŸºç¡€ç»‘å®š
const boundFunc = introduce.bind(person, 'Hello');
boundFunc(25); // "Hello, I'm Alice, 25 years old"

// newè°ƒç”¨æµ‹è¯•
function Person(name) { this.name = name; }
const BoundPerson = Person.bind(null, 'Bob');
const instance = new BoundPerson();
console.log(instance.name); // "Bob"ï¼ˆè¯æ˜newæ“ä½œç¬¦ä¼˜å…ˆçº§é«˜äºbindï¼‰
```
#### âœ…ï¸å®ç° LRU ç¼“å­˜ï¼ˆç±»ï¼‰
```javascript

//åˆ©ç”¨Mapä¿è¯é¡ºåº
class LRUCache {
  constructor(capacity) {
    this.capacity = capacity
    this.cache = new Map()
  }

  get(key) {
    if (!this.cache.has(key)) {
      return -1
    }
    // è·å–å¹¶åˆ é™¤ï¼Œå†é‡æ–° setï¼ˆæ”¾åˆ°æœ€åï¼Œè¡¨ç¤ºæœ€è¿‘ä½¿ç”¨ï¼‰
    const value = this.cache.get(key)
    this.cache.delete(key)
    this.cache.set(key, value)
    return value
  }

  put(key, value) {
    if (this.cache.has(key)) {
      this.cache.delete(key) // åˆ é™¤æ—§çš„
    } else if (this.cache.size >= this.capacity) {
      // åˆ é™¤æœ€æ—§çš„å…ƒç´ ï¼ˆMapçš„ç¬¬ä¸€ä¸ªé”®ï¼‰
      const oldestKey = this.cache.keys().next().value
      this.cache.delete(oldestKey)
    }
    this.cache.set(key, value)
  }
}
```
#### âœ…ï¸æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆé€’å½’ä¸åŠ¨æ€è§„åˆ’ï¼‰
```javascript
function fib(n){
	if(n<2)return n
	let p=0,q=1
	const MOD = 1e9 + 7
	for(let i=2;i<n;i++){
		[p,q] = [q,(p+q)%MOD]
	}
	return q
}
```
#### â€œé›¶é’±å…‘æ¢â€ åŠ¨æ€è§„åˆ’
#### â€œæœ€å¤§ä¹˜ç§¯å­æ•°ç»„â€
####  â€œä¸‰æ•°ä¹‹å’Œä¸º0â€
```javascript
//æ’åº
//å›ºå®šä¸€ä½ï¼Œå‰©ä¸‹ä¸¤ä½åŒæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘å¤´å°¾
//ç»“æœå°äº0ï¼Œå¤´å¾€åç§»åŠ¨ï¼Œç»“æœå¤§äº0ï¼Œå°¾å¾€å‰ç§»åŠ¨
```
#### âœ…ï¸äºŒå‰æ ‘çš„ä¸­åº/å±‚åºéå†
```javascript
function midOrder(root){
	const arr = []
	function dfs(root){
		if(!root)return
		dfs(root.left)
		arr.push(root)
		dfs(root.right)
	}
	return arr
}
function layerOrder(root){
	const arr = []
	function dfs(root,layer){
		if(!root)return
		if(!arr[layer]){
			arr[layer] = []
		}
		arr[layer].push(root)
		dfs(root.left,layer+1)
		dfs(root.right,layer+1)
	}
	dfs(root,0)
	return arr
}
```
#### å¦‚ä½•åˆ¤æ–­é“¾è¡¨æœ‰ç¯ï¼Ÿå¦‚ä½•æ‰¾å‡ºç¯èµ·ç‚¹ï¼Ÿ
#### å¦‚ä½•æ‰¾å‡ºä¸€ä¸ªæ•°ç»„ä¸­åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ï¼Ÿ
#### è®¡ç®—N ä»¥å†…çš„æ‰€æœ‰ç´ æ•°
#### åˆ¤æ–­æ˜¯å¦æœ‰å¾ªç¯ä¾èµ–
```javascript
const modules = [
{ name: "A", dependencies: ["B", "C"] }, 
{ name: "B", dependencies: ["D"] }, 
{ name: "C", dependencies: ["B"] }, 
{ name: "D", }
]
```
#### ç»™å®šmä¸ªæ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„æŒ‰ç…§å‡åºæ’åˆ—ï¼Œç°åœ¨è¦æ±‚ä»ä¸¤ä¸ªä¸åŒçš„æ•°ç»„å–ä¸¤ä¸ªæ•´æ•°ï¼Œæ±‚å·®çš„ç»å¯¹å€¼ã€‚è¦æ±‚ç»å¯¹å€¼æœ€å¤§ã€‚
```javascript
è¾“å…¥ï¼š[[1,2,3],[4,5],[1,2,3]], 
è¾“å‡ºï¼š4 
è§£é‡Šï¼šå–1å’Œ5ï¼Œæ±‚ç»å¯¹å€¼
```

---

## ğŸ“¦ å…­ã€é¡¹ç›®ç›¸å…³é—®é¢˜ï¼ˆ9é¢˜ï¼‰

### å¾®ä¿¡å°ç¨‹åºç»„ä»¶å°è£…
#### å¾®ä¿¡å°ç¨‹åºåŸç†ï¼Œå’Œh5çš„åŒºåˆ«
å°ç¨‹åºçš„åº•å±‚åŸç†æ˜¯hybridåº”ç”¨ï¼Œé‡‡ç”¨`webview`+`åŸç”Ÿç»„ä»¶`ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰
H5çš„åº•å±‚æ˜¯Web
å°ç¨‹åºçš„åŒçº¿ç¨‹æ¶æ„ï¼š
- é€»è¾‘å±‚APPServiceï¼šè¿è¡Œå¼€å‘è€…ä¸šåŠ¡é€»è¾‘ï¼ˆJSï¼‰
- è§†å›¾å±‚WebViewï¼šWXML/WXS/WXSSæ¸²æŸ“å±‚ï¼Œé‡‡ç”¨webviewã€‚ä¸€ä¸ªå°ç¨‹åºæœ‰å¤šä¸ªé¡µé¢ï¼Œæ‰€ä»¥æ¸²æŸ“å±‚å­˜åœ¨å¤šä¸ªwebviewçº¿ç¨‹
ä¸¤ä¸ªçº¿ç¨‹é—´é€šä¿¡ä¼šç»ç”±å¾®ä¿¡ï¼ˆnativeï¼‰åšä¸­è½¬ã€‚
ä¸åŒæ“ä½œç³»ç»Ÿä¸­å°ç¨‹åºè¿è¡Œç¯å¢ƒä¸åŒï¼š
```markdown
| æ“ä½œç³»ç»Ÿ | é€»è¾‘å±‚ | æ¸²æŸ“å±‚ |
| --- | --- | --- |
| IOS | JSCore | WKWebView |
| Android | V8 | åŸºäºMobile Chromiumçš„è‡ªç ”å¼•æ“ |
| Windows | chromium | chromium |
| å°ç¨‹åºå¼€å‘è€…å·¥å…· | NWJS | Chrome WebView |
```
ç”±äºæ¸²æŸ“å±‚æ˜¯webviewï¼Œæ‰€ä»¥å°ç¨‹åºç»„ä»¶å¤§å¤šæ˜¯HTMLï¼Œä½†ä¹Ÿæœ‰ä¸€äº›åŸç”Ÿç»„ä»¶ï¼Œä¾‹å¦‚`map`ï¼Œè¿™ç±»ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œwebviewä¼šå…ˆç»™ä¸€ä¸ªå ä½å…ƒç´ ï¼Œç„¶ånativeå†æŠŠåŸç”Ÿæ§ä»¶å ä¸Šå»ã€‚

å¾®ä¿¡å°ç¨‹åºçš„`Skyline`æ–°å¼•æ“ï¼šç‹¬ç«‹åˆ›å»ºä¸€æ¡æ¸²æŸ“å¼•æ“ï¼Œåœ¨AppServiceä¸­è¿è¡Œä¸€äº›ä¹‹å‰WebViewæ‰¿æ‹…çš„JSé€»è¾‘ã€DOMæ ‘åˆ›å»ºç­‰é€»è¾‘ã€‚
#### setDataåŸç†ä¸å‘
setDataå°±æ˜¯å°†JSçº¿ç¨‹ä¸­çš„æ•°æ®é€šè¿‡`JSONåºåˆ—åŒ–`åä¼ ç»™è§†å›¾çº¿ç¨‹ï¼Œç„¶åè§†å›¾å±‚æ ¹æ®dataæ¸²æŸ“ç»„ä»¶ï¼š
1. é€»è¾‘å±‚è™šæ‹ŸDOM treeçš„éå†å’Œæ›´æ–°ï¼Œè§¦å‘ç”Ÿå‘½å‘¨æœŸå’Œobserverç­‰
2. å°†dataä»é€»è¾‘å±‚ä¼ è¾“åˆ°è§†å›¾å±‚
3. è§†å›¾å±‚è™šæ‹ŸDOM treeçš„æ›´æ–°ï¼ŒçœŸå®DOMå…ƒç´ çš„æ›´æ–°å¹¶è§¦å‘é¡µé¢é‡æ–°æ¸²æŸ“
ç¬¬äºŒæ­¥ç”±äºwebViewå’ŒJS coreæ˜¯ç‹¬ç«‹çš„çº¿ç¨‹ï¼Œæ•°æ®ä¼ è¾“ä¼šæœ‰é¢å¤–çš„JSè„šæœ¬è§£æå’Œæ‰§è¡Œï¼Œå› æ­¤æ•°æ®åˆ°è¾¾æ¸²æŸ“å±‚æ˜¯å¼‚æ­¥çš„ï¼ˆçº¿ç¨‹é—´é€šä¿¡ï¼‰ï¼Œå› æ­¤ï¼š
setDataçš„é™åˆ¶ï¼š
- åªèƒ½æ˜¯çº¯JSONå¯¹è±¡ï¼Œæ‰€ä»¥ä¸æ”¯æŒå‡½æ•°ã€å¾ªç¯å¼•ç”¨ã€Symbol
- å±‚çº§ä¸èƒ½å¤ªæ·±ï¼Œè¶…è¿‡2-3å±‚æ€§èƒ½æ˜æ˜¾ä¸‹é™
- æ•°æ®é‡è¿‡å¤§ä¾‹å¦‚å¤§å¯¹è±¡æ•°ç»„ä¼šé€ æˆå¡é¡¿
- ä¸å»ºè®®é¢‘ç¹è°ƒç”¨ï¼Œå»ºè®®åˆå¹¶è°ƒç”¨æˆ–è€…ç²¾ç®€å­—æ®µ
ä½¿ç”¨æŠ€å·§ï¼š
- ç”±äºè§†å›¾æ›´æ–°æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥è¦æ“ä½œå…ƒç´ ï¼Œéœ€è¦ï¼š
```javascript
this.setData({ val:123 },()=>{
// åœ¨æ­¤å¤„æ“ä½œDOM
})
```
- setDataæ›´æ–°æ·±å±‚å¯¹è±¡æ•°æ®ï¼š
```javascript
this.setData({
	'user.info.name': 'walker'
})
```
#### JSBridge
ä½œç”¨ï¼šè®©webview/JScoreä¸­çš„JSä¸nativeé€šä¿¡ï¼Œä»è€Œè°ƒç”¨nativeçš„èƒ½åŠ›
1. JSé€šçŸ¥native
```javascript
//æ–¹æ³•ä¸€ï¼ˆè€ï¼‰ï¼š
const iframe = document.createElement('iframe')
iframe.src = 'jsbridge://camera/open?params=xxx'
document.body.appendChild(iframe)
//nativeæ“ä½œï¼š
//1.ç›‘å¬è¯¥åè®®å¤´ã€‚ä¾‹å¦‚jsbridge
//2.æ‹¦æˆªè¯·æ±‚ï¼Œæ‰§è¡Œé€»è¾‘
//3.æ‰§è¡Œå®Œåå›è°ƒJS

//æ–¹æ³•äºŒï¼ˆæ–°iosï¼‰ï¼šä½¿ç”¨WebKitå†…ç½®æ¥å£
window.webkit.messageHandlers.bridgeName.postMessage({
	method: 'openCamera'
})

//æ–¹æ³•äºŒï¼ˆæ–°Androidï¼‰
window.AndroidInterface.openCamera()
```
2. Nativeç›‘å¬
```swift
//ios
func userContentController(_ controller: WKUserContentController, didReceive message: WKScriptMessage) {
  if message.name == "bridgeName" {
    // è§£æ message.body æ‰§è¡ŒåŸç”Ÿæ“ä½œ
  }
```
```java
//Android
@JavascriptInterface
public void openCamera() {
  // æ‰§è¡ŒåŸç”Ÿæ“ä½œ
}
```
3. Nativeå›è°ƒJS
```java
// Android
webView.evaluateJavascript("window.onNativeResult('æ‹ç…§å®Œæˆ')", null)

// iOS
webView.evaluateJavaScript("window.onNativeResult('æ‹ç…§å®Œæˆ')", nil)
```
#### ä¼ å‚ã€è·³è½¬æ‰‹æ®µ
1. URLä¼ å‚
```javascript
//pageA
wx.navigateTo({
  url: `/pages/detail/index?id=123&name=${encodeURIComponent('æ—åšæ–‡')}`
})
//pageB
Page({
  onLoad() {
    const user = wx.getStorageSync('currentUser')
    wx.removeStorageSync('currentUser') // ç”¨å®Œæ¸…é™¤é˜²æ±¡æŸ“
  }
})
```
2. eventChannelä¼ å‚
```javascript
// é¡µé¢A
wx.navigateTo({
  url: '/pages/B/index',
  success(res) {
    res.eventChannel.emit('acceptDataFromA', { name: 'æ—åšæ–‡' })
  }
})
// é¡µé¢B
Page({
  onLoad() {
    const eventChannel = this.getOpenerEventChannel()
    eventChannel.on('acceptDataFromA', (data) => {
      console.log(data)
    })
  }
})
```
3. å¾®ä¿¡æœ¬åœ°ç¼“å­˜
```javascript
// è·³è½¬å‰
wx.setStorageSync('currentUser', { name: 'æ—åšæ–‡', age: 18 })

// é¡µé¢ä¸­
Page({
  onLoad() {
    const user = wx.getStorageSync('currentUser')
    wx.removeStorageSync('currentUser') // ç”¨å®Œæ¸…é™¤é˜²æ±¡æŸ“
  }
})
```
4. å…¨å±€å˜é‡
```javascript
const app = getApp()
const xxx = app.globalData['xxx']
```

- `wx.navigateTo()` : ä¿ç•™å½“å‰é¡µé¢ï¼Œè·³è½¬åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢ã€‚ä½†æ˜¯ä¸èƒ½è·³åˆ° `tabbar` é¡µé¢
- `wx.redirectTo()` : å…³é—­å½“å‰é¡µé¢ï¼Œè·³è½¬åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢ã€‚ä½†æ˜¯ä¸å…è®¸è·³è½¬åˆ° `tabbar` é¡µé¢
- `wx.switchTab()` : è·³è½¬åˆ° `TabBar` é¡µé¢ï¼Œå¹¶å…³é—­å…¶ä»–æ‰€æœ‰é `tabBar` é¡µé¢
- `wx.navigateBack()` : å…³é—­å½“å‰é¡µé¢ï¼Œè¿”å›ä¸Šä¸€é¡µé¢æˆ–å¤šçº§é¡µé¢ã€‚å¯é€šè¿‡`getCurrentPages()` è·å–å½“å‰çš„é¡µé¢æ ˆï¼Œå†³å®šéœ€è¦è¿”å›å‡ å±‚
- `wx.reLaunch()` : å…³é—­æ‰€æœ‰é¡µé¢ï¼Œæ‰“å¼€åˆ°åº”ç”¨çš„æŸä¸ªé¡µé¢ã€‚

#### ç™»å½•æµç¨‹
1. `wx.login()`å¾—åˆ°ç™»å½•ç `code`
2. æºå¸¦`code`è¯·æ±‚æœåŠ¡å™¨ç™»å½•æ¥å£
3. æœåŠ¡å™¨ä½¿ç”¨`appId+appSecret+code`è¯·æ±‚å¾®ä¿¡æœåŠ¡å™¨ï¼Œå¾—åˆ°`session_keyå’Œopenid`
4. æœåŠ¡å™¨å°†`session_key`å’Œ`openid`æ¢ç®—æˆtokenï¼Œè¿”å›ç»™å®¢æˆ·ç«¯
5. åç»­è¯·æ±‚è¿‡ç¨‹ä¸­éƒ½ä½¿ç”¨tokené‰´æƒ
![image.png](https://raw.githubusercontent.com/exwer/img_bed/master/picGo/20250717032429.png)
è¯·æ±‚å¤´è‡ªåŠ¨æºå¸¦tokenï¼š
```javascript
     let token = wx.getStorageSync('fcToken');
     if (token != '') {
       params.header.Authorization = token;
     }
```
è·³è½¬h5å¸¦tokenï¼š
```javascript
     let token = wx.getStorageSync('fcToken') || '';
     h5url: `${rawH5url}${rawH5url.indexOf('?') > -1 ? '&' : '?'}token=${token}&isfcMini=1`
```
#### æ”¯ä»˜æµç¨‹
![image.png](https://raw.githubusercontent.com/exwer/img_bed/master/picGo/20250717031219.png)

#### æ‰“å¼€h5é¡µé¢æµç¨‹
è·³è½¬åˆ°h5containerç»„ä»¶ï¼Œè¯¥ç»„ä»¶åªæœ‰ä¸€ä¸ªwebviewå…ƒç´ ï¼Œåœ¨è¯¥ç»„ä»¶çš„onloadä¸­decodeURIComponentï¼Œæ‹¿åˆ°h5urlï¼Œç„¶åä»å…¨å±€çŠ¶æ€é‡Œæ‹¿åˆ°tokenï¼ˆæˆ–å…¶ä»–éœ€è¦çš„æ•°æ®ï¼‰ï¼Œæ‹¼æ¥åˆ°urlåï¼Œèµ‹å€¼ç»™webview
H5é¡µé¢æ£€æµ‹æ˜¯å¦åœ¨å¾®ä¿¡ç¯å¢ƒæ–¹æ³•ï¼š
```javascript
//æ–¹æ³•ä¸€ï¼šé€šè¿‡userAgent
function isInMicroMessenger() {  
	return /MicroMessenger/i.test(navigator.userAgent);  
}
//æ–¹æ³•äºŒï¼šé€šè¿‡å¾®ä¿¡æä¾›çš„JSbridgeï¼ˆå¾®ä¿¡æ‰“å¼€çš„ç½‘é¡µè‡ªåŠ¨æ³¨å…¥JSbridgeï¼‰
function isInWeixinWebView() {  
	return typeof window.WeixinJSBridge === 'object' && typeof window.WeixinJSBridge.invoke === 'function';  
}
```

#### rpxåŸç†
åŸç†ï¼Œ1rpxåœ¨å¾®ä¿¡å†…æ ¸ä¸­æ¢ç®—ï¼š`rpxScale = å±å¹•å®½åº¦ / 750`æˆpxï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å®½åº¦ä¸º750çš„å±å¹•ä¸­ï¼Œ1rpx = 1px

#### ç»„ä»¶å°è£…


### å°ç¨‹åºåŸ‹ç‚¹
å®˜æ–¹çš„åŸ‹ç‚¹å’Œè‡ªæœ‰çš„åŒºåˆ«
å¦‚ä½•ä¿è¯ä¸šåŠ¡åŸ‹ç‚¹æ•°æ®çš„å‡†ç¡®æ€§
å°†å®˜æ–¹åŸ‹ç‚¹æ›´æ¢ä¸ºè‡ªæœ‰åŸ‹ç‚¹æ—¶å¦‚ä½•è¿›è¡Œæµ‹è¯•
åŸ‹ç‚¹å¦‚ä½•å¤„ç†æç«¯æƒ…å†µï¼Œå¦‚å¼±ç½‘ï¼Œå´©æºƒç­‰

### lintã€TSã€git hooksã€CRå¦‚ä½•æ‹¦æˆªçº¿ä¸Šéšæ‚£

### H5é¦–å±é€»è¾‘ä¼˜åŒ– 3.2s -> 0.7s

### Vueç»„ä»¶å°è£…
å¯è§†åŒ–æŸœæœºç»„ä»¶ã€åœ°å€ç©¿æ¢­æ¡†ã€Modalã€Toastã€å…¨å±€loading

### i18næ’ä»¶å®ç°åŸç†ï¼Ÿviteæ’ä»¶ã€å›½é™…åŒ–

### å‰ç«¯å•å…ƒæµ‹è¯•

### webpackåˆ°viteçš„å‡çº§

### webSocketåº”ç”¨

1. æè¿°ä½ åšçš„é¡¹ç›®ï¼šèƒŒæ™¯ã€ç›®æ ‡ã€æŠ€æœ¯é€‰å‹ã€ä½ çš„è§’è‰²ï¼Ÿ
2. ä½ åœ¨é¡¹ç›®ä¸­é‡åˆ°çš„æœ€å¤§æŠ€æœ¯éš¾é¢˜æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ
3. ä¸ºä»€ä¹ˆé€‰æ‹©ä½¿ç”¨ Vue3 + TS è€Œä¸æ˜¯ Vue2ï¼Ÿ
4. é¡¹ç›®ä¸­å¦‚ä½•åšæƒé™æ§åˆ¶ï¼Ÿ
5. é¡¹ç›®å¦‚ä½•å¤„ç† Tokenï¼Ÿå­˜å‚¨åœ¨å“ªé‡Œï¼Ÿä¸ºä½•å¦‚æ­¤è®¾è®¡ï¼Ÿ
6. ä½ æ˜¯å¦‚ä½•åšæ¥å£å¹‚ç­‰å¤„ç†çš„ï¼Ÿ
7. é¡¹ç›®ä¸­æœ‰åšå›½é™…åŒ–å—ï¼Ÿå¦‚ä½•å®ç°çš„ï¼Ÿ
8. é¡¹ç›®å¦‚ä½•å®ç°å“åº”å¼å¸ƒå±€ï¼Ÿé€‚é…ç§»åŠ¨ç«¯ä¸ PCï¼Ÿ
9. é¡¹ç›®å¦‚ä½•åšæ€§èƒ½ä¼˜åŒ–ï¼Ÿå¦‚é¦–å±åŠ è½½é€Ÿåº¦ã€èµ„æºå‹ç¼©ç­‰ï¼Ÿ

---

## ğŸ¯ ä¸ƒã€ç³»ç»Ÿè®¾è®¡ä¸åœºæ™¯é¢˜ï¼ˆ7é¢˜ï¼‰

### ç™»å½•æµç¨‹çš„å…¨é“¾è·¯è®¾è®¡ï¼ŸTokenã€è·³è½¬ã€æƒé™ï¼Ÿ
**Tokenç®¡ç†**ï¼š
    
    - ä½¿ç”¨HttpOnly Secure Cookieå­˜å‚¨Refresh Token
        
    - å†…å­˜ä¸­ç®¡ç†Access Tokenï¼ˆVuex/Piniaï¼‰ï¼Œå®šæ—¶åˆ·æ–°
        
- **æƒé™æ§åˆ¶**ï¼š
    
    - è·¯ç”±çº§ï¼šåŠ¨æ€è·¯ç”±è¡¨ï¼ˆæ ¹æ®è§’è‰²ä»æœåŠ¡ç«¯è·å–ï¼‰
        
    - ç»„ä»¶çº§ï¼š`<AuthButton permission="DELETE_USER">`
        
- **å®‰å…¨åŠ å›º**ï¼š
    
    - å…³é”®æ“ä½œäºŒæ¬¡éªŒè¯ï¼ˆçŸ­ä¿¡/é‚®ä»¶ï¼‰
        
    - ç™»å½•æ€åŠ å¯†ç»‘å®šè®¾å¤‡æŒ‡çº¹
### å¦‚æœç”¨æˆ·åœ¨æ–­ç½‘çŠ¶æ€ä¸‹æ“ä½œè¡¨å•ï¼Œæ€ä¹ˆå¤„ç†æäº¤é€»è¾‘ï¼Ÿ
```javascript
// è¡¨å•æäº¤é€»è¾‘
async function submitForm(data) {
  if (!navigator.onLine) {
    // 1. å­˜å‚¨åˆ°IndexedDB
    await idb.save('pendingForms', data); 
    // 2. æ³¨å†Œç½‘ç»œæ¢å¤ç›‘å¬
    window.addEventListener('online', retrySubmit);
    // 3. æ˜¾ç¤ºå‹å¥½æç¤º
    showToast('æ•°æ®å·²ä¿å­˜ï¼Œç½‘ç»œæ¢å¤åè‡ªåŠ¨æäº¤');
    return;
  }
  // æ­£å¸¸æäº¤...
}

// ç½‘ç»œæ¢å¤å¤„ç†
function retrySubmit() {
  idb.getAll('pendingForms').then(forms => {
    forms.forEach(form => fetch('/submit', form));
    idb.clear('pendingForms');
  });
}
```
### å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¤šè¯­è¨€ç«™ç‚¹çš„èµ„æºåŠ è½½ä¸ fallbackï¼Ÿ
![deepseek_mermaid_20250712_1da6f3.png](https://raw.githubusercontent.com/exwer/img_bed/master/picGo/deepseek_mermaid_20250712_1da6f3.png)


### å¦‚ä½•å¤„ç†å¤šä¸ªè¯·æ±‚å¹¶å‘ï¼Œé¿å…è¯·æ±‚é‡å¤ï¼Ÿ
https://juejin.cn/post/7341840038964363283
### å¦‚æœé¡µé¢æ•°æ®ä¾èµ–å¤šä¸ªæ¥å£ï¼Œå¦‚ä½•ç»Ÿä¸€ loading çŠ¶æ€ï¼Ÿ
```javascript
// åŸºäºPromise.allSettledçš„å°è£…
function createLoadingManager() {
  const state = reactive({ count: 0, isLoading: false });
  
  return {
    state,
    wrapRequest: (promise) => {
      state.count++;
      state.isLoading = true;
      
      return promise.finally(() => {
        state.count--;
        state.isLoading = state.count > 0;
      });
    }
  };
}

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
const { wrapRequest, state } = createLoadingManager();

onMounted(async () => {
  const [userReq, orderReq] = [
    wrapRequest(fetchUser()),
    wrapRequest(fetchOrders())
  ];
  
  await Promise.allSettled([userReq, orderReq]);
});
```
### å‰ç«¯é¡¹ç›®ä¸­å¦‚ä½•å®ç°ç°åº¦å‘å¸ƒï¼Ÿ
![image.png](https://raw.githubusercontent.com/exwer/img_bed/master/picGo/20250712143028.png)

### å¦‚æœä½ æ¥è®¾è®¡ä¸€ä¸ªç»„ä»¶åº“ï¼Œæ€ä¹ˆåšæ¶æ„è®¾è®¡ï¼Ÿ
![image.png](https://raw.githubusercontent.com/exwer/img_bed/master/picGo/20250712143055.png)

![image.png](https://raw.githubusercontent.com/exwer/img_bed/master/picGo/20250712143104.png)

---
